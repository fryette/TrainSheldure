<views:MvxWindowsPage x:Class="Trains.WP.Views.MainView"
                      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                      xmlns:views="using:Cirrious.MvvmCross.WindowsCommon.Views"
                      xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
                      xmlns:core="using:Microsoft.Xaml.Interactions.Core"
                      mc:Ignorable="d"
                      Background="{StaticResource BackgroundColorBrush}"
                      RequestedTheme="Dark"
                      d:DataContext="{d:DesignData MainViewModel}">
    <Grid>
        <Grid.Resources>
            <Storyboard x:Name="MyStoryboard">
                <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateX)"
                                               AutoReverse="True"
                                               RepeatBehavior="forever"
                                               Storyboard.TargetName="MainImage">
                    <EasingDoubleKeyFrame KeyTime="0"
                                          Value="100" />
                    <EasingDoubleKeyFrame KeyTime="0:0:12"
                                          Value="0" />
                </DoubleAnimationUsingKeyFrames>
            </Storyboard>
        </Grid.Resources>
        <Pivot x:Name="MainPivot"
               Title="{Binding ApplicationName}"
               PivotItemLoaded="Pivot_OnPivotItemLoaded">
            <PivotItem Header="{Binding MainPivotItem}"
                       x:Name="MainPivotItem">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="170" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <GridView Grid.Row="0"
                              Margin="0,10,0,-10">
                        <Grid>
                            <Image x:Name="MainImage"
                                   Source="/Assets/MenuIcon/result.jpg"
                                   Style="{StaticResource MainButtonImageStyle}" />
                        </Grid>
                    </GridView>
                    <StackPanel Grid.Row="1"
                                Background="{StaticResource GrayColorBrush}">
                        <TextBlock Text="{Binding FastSearchTextBlock}"
                                   FontSize="{StaticResource NormalLargeFontSize}" />
                        <ComboBox ItemsSource="{Binding VariantOfSearch}"
                                  SelectedItem="{Binding SelectedVariant,Mode=TwoWay}">
                        </ComboBox>
                        <DatePicker Header="{Binding DateOfDeparture}"
                                    Date="{Binding Datum,Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Visibility="{Binding IsOnDaySelected,Converter={StaticResource BooleanToVisibilityConverter}}"
                                    Style="{StaticResource DatePickerStyle}" />
                        <AutoSuggestBox PlaceholderText="{Binding FromAutoSuggest}"
                                        Text="{Binding From, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        ItemsSource="{Binding AutoSuggestions}"
                                        IsEnabled="{Binding IsFildEnabled}"
                                        Style="{StaticResource AutoSuggestBoxStyle}"
                                        SuggestionChosen="AutoSuggestBox_SuggestionChosen" />
                        <AutoSuggestBox PlaceholderText="{Binding ToAutoSuggest}"
                                        IsEnabled="{Binding IsFildEnabled,Mode=TwoWay}"
                                        Text="{Binding To, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        ItemsSource="{Binding AutoSuggestions}"
                                        Style="{StaticResource AutoSuggestBoxStyle}"
                                        SuggestionChosen="AutoSuggestBox_SuggestionChosen" />

                        <Button Content="{Binding Search}"
                                HorizontalAlignment="Right"
                                Command="{Binding SearchTrainCommand}" />
                    </StackPanel>
                </Grid>
            </PivotItem>
            <PivotItem Header="{Binding LastSchedulePivotItem}"
                       x:Name="LastPivot">
                <Grid HorizontalAlignment="Center">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="30" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0"
                               Text="{Binding LastRoute}"
                               Style="{StaticResource BasedTextBlockStyle}"
                               FontSize="{StaticResource MainFontSize}"
                               HorizontalAlignment="Center" />
                    <SemanticZoom Grid.Row="1"
                                  x:Name="Root"
                                  Template="{StaticResource SemantickZoom}"
                                  DataContext="{Binding Trains,Converter={StaticResource ListViewConverter}}">
                        <SemanticZoom.ZoomedInView>
                            <ListView x:Name="TrainList"
                                      ItemsSource="{Binding ElementName=Root,Path=DataContext.View}"
                                      ItemTemplate="{StaticResource ScheduleTemplate}"
                                      Tapped="TrainList_OnTapped">
                                <ListView.GroupStyle>
                                    <GroupStyle HeaderTemplate="{StaticResource GenericGroupHeaderTemplate}"
                                                HeaderContainerStyle="{StaticResource JumpListListHeaderContainerStyle}"
                                                HidesIfEmpty="True" />
                                </ListView.GroupStyle>
                            </ListView>
                        </SemanticZoom.ZoomedInView>
                        <SemanticZoom.ZoomedOutView>
                            <ListView ItemsSource="{Binding ElementName=Root,Path=DataContext.View.CollectionGroups}"
                                      ItemTemplate="{StaticResource GenericJumpListPickerItemTemplate}"
                                      Style="{StaticResource GenericJumpListPickerStyle}">
                            </ListView>
                        </SemanticZoom.ZoomedOutView>
                    </SemanticZoom>
                    <Button x:Name="CommandButton"
                            Visibility="Collapsed"
                            Command="{Binding SelectTrainCommand}" />
                </Grid>
            </PivotItem>
            <PivotItem Header="{Binding RoutesPivotItem}"
                       x:Name="RoutesPivot">
                <ListView x:Name="FavoriteRequests"
                          ItemsSource="{Binding FavoriteRequests}"
                          ItemTemplate="{StaticResource ManageFavoriteRequestTemplate}"
                          ItemContainerStyle="{StaticResource ListViewItemStyle}">
                    <interactivity:Interaction.Behaviors>
                        <core:EventTriggerBehavior EventName="Tapped">
                            <core:InvokeCommandAction Command="{Binding TappedFavoriteCommand}"
                                                      CommandParameter="{Binding ElementName=FavoriteRequests, Path=SelectedItem}"
                                                      InputConverter="{StaticResource SelectionChangedConverter}" />
                        </core:EventTriggerBehavior>
                    </interactivity:Interaction.Behaviors>
                </ListView>
            </PivotItem>
            <PivotItem Header="{Binding AboutPivotItem}">
                <ListView x:Name="AboutItemList"
                          ItemsSource="{Binding AboutItems}"
                          ItemContainerStyle="{StaticResource ListViewItemStyle}"
                          ItemTemplate="{StaticResource AboutTemplate}">
                    <interactivity:Interaction.Behaviors>
                        <core:EventTriggerBehavior EventName="Tapped">
                            <core:InvokeCommandAction Command="{Binding TappedAboutItemCommand}"
                                                      CommandParameter="{Binding ElementName=AboutItemList, Path=SelectedItem}"
                                                      InputConverter="{StaticResource SelectionChangedConverter}" />
                        </core:EventTriggerBehavior>
                    </interactivity:Interaction.Behaviors>
                </ListView>
            </PivotItem>
        </Pivot>
        <Grid Visibility="{Binding IsTaskRun,Converter={StaticResource BooleanToVisibilityConverter}}">
            <TextBlock Text="{Binding Update}" />
            <ProgressBar IsIndeterminate="True"
                         VerticalAlignment="Top" />
        </Grid>

        <Grid Background="{StaticResource BackgroundColorBrush}"
              Visibility="{Binding IsDownloadRun,Converter={StaticResource BooleanToVisibilityConverter}}">
            <Image Source="/Assets/SplashScreen.png" />
            <ProgressRing IsActive="True" />
        </Grid>
    </Grid>
    <Page.BottomAppBar>
        <CommandBar>
            <AppBarButton x:Name="UpdateAppBar"
                          Label="{Binding UpdateAppBar}"
                          Icon="Sync"
                          Command="{Binding UpdateLastRequestCommand}" />
            <AppBarButton x:Name="SwapAppBar"
                          Label="{Binding SwapAppBar}"
                          Icon="Sort"
                          Command="{Binding SwapCommand}" />
            <AppBarButton x:Name="ManagedAppBar"
                          Label="{Binding ManageAppBar}"
                          Icon="Repair"
                          Command="{Binding GoToEditFavoriteCommand}" />
            <AppBarButton Label="{Binding HelpAppBar}"
                          Icon="Help"
                          Command="{Binding GoToHelpCommand}" />
        </CommandBar>
    </Page.BottomAppBar>
</views:MvxWindowsPage>
